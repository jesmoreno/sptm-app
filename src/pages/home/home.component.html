<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=Lobster&subset=latin,latin-ext" rel="stylesheet" type="text/css">

<navigation-menu></navigation-menu>
<div class="home-container">
	<create-game #gameForm [address]="addressClicked"></create-game>
	<div id="locate-in-map">
		<div class="searchCity">
			<form [formGroup]="searchGamesForm">
				<mat-form-field>
				    <input #city matInput placeholder="CP, ciudad" autocomplete="off" formControlName="direction">
					<mat-error>{{errorMessage}}</mat-error>
				</mat-form-field>
				<button mat-raised-button (click)="search(city.value)" [disabled]="searchGamesForm.controls['direction'].errors"><mat-icon matSuffix>search</mat-icon></button>
			</form>
		</div>
		<div *ngIf="games?.length; else emptyMap">
			<agm-map [zoom]='zoom' [latitude]='games[0].address.location.coordinates[1]' [longitude]='games[0].address.location.coordinates[0]'
			(mapDblClick)=setPositionOnMap($event) [disableDoubleClickZoom]=true>
				<div *ngFor="let game of games; let i = index">
					<agm-marker [latitude]='game.address.location.coordinates[1]' [longitude]='game.address.location.coordinates[0]' [iconUrl]='marker' [title]='game.name' (markerClick)=showMarkerInfo($event)>
					</agm-marker>
				</div>
			</agm-map>
		</div>
		<ng-template #emptyMap>
			<div class="map-no-games-found">
				<agm-map [zoom]='13' [latitude]="coordsSearched?.latitude" [longitude]="coordsSearched?.longitude" (mapDblClick)=setPositionOnMap($event) [disableDoubleClickZoom]=true>
				</agm-map>
				<div id="not-found-games">
					<p [innerHTML]="errorGamesMessage"></p>
				</div>
			</div>
		</ng-template>
		<mat-radio-group class="radio-group" [(ngModel)]="sportSelected" #options (change)="resetGames()">
  			<mat-radio-button class="radio-button" color="primary" *ngFor="let sport of sportsFilter" [value]="sport">
    			{{sport}}
  			</mat-radio-button>
		</mat-radio-group>
		<mat-radio-group class="radio-group" [(ngModel)]="gameSelected">
  			<mat-radio-button class="radio-button" color="primary" *ngFor="let game of gamesFilter" [value]="game" (change)="resetGames()">
    			{{game}}
  			</mat-radio-button>
		</mat-radio-group>
	</div>
	
	<div id="info-game-clicked" *ngIf="gameClicked; else infoClickMarker">
		<button *ngIf="gameOwner" (click)="onCloseClick()" class="close" aria-label="close" title="Eliminar partida">&times;</button>
		<div class="add-friend-wrapper" *ngIf="gameOwner">
			<mat-form-field>
		  		<input type="text" #input placeholder="AÃ±adir amigo" matInput [formControl]="myControl" [matAutocomplete]="auto">
			</mat-form-field>
			<mat-autocomplete #auto="matAutocomplete">
		  		<mat-option *ngFor="let option of filteredOptions | async" [value]="option.name">{{option.name}}</mat-option>
			</mat-autocomplete>
		</div>
		<div *ngIf="gameClicked; else notGameInfo">
			<h1>{{gameClicked.name}}</h1>
			<div>{{gameClicked.address.formatted_address}}</div>
			<div class="clicked-game-players-list">
				<h3>Lista de jugadores ({{gameClicked.players.length}})</h3>
				<button *ngIf="gameSelected == 'Resto' && gameClicked.players.length < gameClicked.maxPlayers" class="edit-list-button" title="Unirme" mat-raised-button (click)="editList()"><mat-icon>add</mat-icon></button>
			</div>
			<ul>
				<li *ngFor="let player of gameClicked.players">
					{{player.playerName}}
				</li>
			</ul>
		</div>
		<ng-template #notGameInfo>
			<h1>No hay partidos</h1>
		</ng-template>
	</div>
	<ng-template #infoClickMarker>
		<div id="info-message">
			<p class="info-alert">Selecciona una partida sobre el mapa</p>
		</div>
	</ng-template>
</div>
<spinner *ngIf="showSpinner"></spinner>
